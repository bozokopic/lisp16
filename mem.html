<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="search" title="Search" href="search.html" /><link rel="next" title="Input/output stream" href="stream.html" /><link rel="prev" title="Data types" href="cell.html" />

    <meta name="generator" content="sphinx-5.2.0.post0, furo 2022.09.15"/>
        <title>Memory management - lisp16 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=9ec31e2665bf879c1d47d93a8ec4893870ee1e45" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">lisp16  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">lisp16  documentation</span>
  
</a><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="arch.html">Architecture abstraction layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="status.html">Result status codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="cell.html">Data types</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Memory management</a></li>
<li class="toctree-l1"><a class="reference internal" href="stream.html">Input/output stream</a></li>
<li class="toctree-l1"><a class="reference internal" href="buff.html">String buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="read.html">Data reader</a></li>
<li class="toctree-l1"><a class="reference internal" href="write.html">Data writer</a></li>
<li class="toctree-l1"><a class="reference internal" href="builtin.html">Builtin</a></li>
<li class="toctree-l1"><a class="reference internal" href="ctx.html">Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="env.html">Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="eval.html">Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply.html">Function/syntax application</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax.html">Builtin syntaxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="function.html">Builtin functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="repl.html">REPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="main.html">Main</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>

</div></div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="memory-management">
<h1>Memory management<a class="headerlink" href="#memory-management" title="Permalink to this heading">#</a></h1>
<p>Functions declared in <cite>mem.h</cite> provide interface for usage of dynamically
allocated data. All other modules interact with dynamic data only through
these functions.</p>
<section id="memory-layout">
<h2>Memory layout<a class="headerlink" href="#memory-layout" title="Permalink to this heading">#</a></h2>
<p>State of memory management is represented with structure <cite>lsp_mem_t</cite>. It
contains continuous memory block of platform specific word count.
Addresses used for referencing each data correspond to this memory block
starting word index. Because addresses are represented with 14bit unsigned
integer values, usable memory for allocation of dynamic data is limited to
16384 words (32768 bytes). In case of memory constrained systems, this
size is even smaller.</p>
</section>
<section id="data-allocation">
<h2>Data allocation<a class="headerlink" href="#data-allocation" title="Permalink to this heading">#</a></h2>
<p>Each word (event those which are not single data starting words) have
single bit dedicated for memory management usage. This most significant bit
represent words current usage state where <code class="docutils literal notranslate"><span class="pre">0</span></code> represents used word (word is
used for representing data content) and <code class="docutils literal notranslate"><span class="pre">1</span></code> represent unused word (word is
available for allocation of new data instance).</p>
<p>During allocation of new data, all available words are searched for
continuous block of unused words which could be used to represent newly
allocated data content. If such word block could not be found, garbage
collection procedure is triggered, after which search for free block is
repeated. If search is not successful for the second time, allocation
of new data fails. If search is successful, address of newly allocated data
is remembered and used as starting address for future allocation searches.</p>
<p>All <cite>lsp_mem_create_*</cite> functions, used for data allocation, add allocated
data to list of accessible root data. Management of accessible data is
possible with <cite>lsp_mem_inc_ref</cite> and <cite>lsp_mem_dec_ref</cite> which increase and
decrease references to root data. Once data is not part of root list or is not
referenced by other data which are part of root list, it is considered
not accessible and can be reclaimed by garbage collector.</p>
<p>During memory initialization, often used data instances are preallocated and
available as part of <cite>lsp_mem_t</cite> structure (<cite>nil</cite>, <cite>zero</cite>, <cite>one</cite>, <cite>quote</cite>,
<cite>quasiquote</cite>, <cite>unquote</cite> and <cite>unquote_splicing</cite>).</p>
</section>
<section id="garbage-collector">
<h2>Garbage collector<a class="headerlink" href="#garbage-collector" title="Permalink to this heading">#</a></h2>
<p>Garbage collector is based on variant of simple mark and sweep design.
Initially, all memory words are marked as free. Once words are used for data
representation, used words are immediately marked as non free. After
repeated allocation of new data instances, pool of available free words
is depleted and garbage procedure is started.</p>
<p>As first step of garbage collection, all memory words are marked as free.
Then, words used for representation of root list are marked as non free by
usage of recursive function which, together with immediately used words, marks
all other referenced data words. Data types which reference other data are
<cite>pair</cite>, <cite>function</cite> and <cite>syntax</cite>. After all data directly and indirectly
referenced by root list is marked as used, garbage collection finishes
(all other words remain marked as unused).</p>
</section>
<section id="data-usage">
<h2>Data usage<a class="headerlink" href="#data-usage" title="Permalink to this heading">#</a></h2>
<p>Together with data allocation function, memory management functions include
interface for manipulation and usage of allocated data. These include
<cite>lsp_mem_is_*</cite> function for data type assertion and <cite>lsp_mem_get_*</cite> functions
for data content retrieval. This functions provide thin wrapper for <cite>cell.h</cite>
functions with mapping of data addresses to data words.</p>
<p>All data types, except for <cite>string</cite> and <cite>pair</cite> are considered immutable -
data content is initialized during allocation and is not mutated afterwards.
In case of <cite>string</cite> and <cite>pair</cite> data, <cite>lsp_mem_set_*</cite> functions enable
in place modification of data instance content. In case of <cite>string</cite> data,
only content of preallocated size can be modified (size of string can not
change after allocation).</p>
<p>All other parts of interpreter use only <cite>lsp_mem_*</cite> wrappers instead of
direct <cite>lsp_cell_*</cite> function usage.</p>
</section>
<section id="symbol-reusability">
<h2>Symbol reusability<a class="headerlink" href="#symbol-reusability" title="Permalink to this heading">#</a></h2>
<p>Because symbols are immutable, memory usage optimization can be done during
symbol allocation. Each time new symbol should be allocated, content of
all memory words is searched for already allocated symbol with same content.
If such instance is found, reference to already existing symbol is returned
together with incrementing this reference in root list. This optimization
comes with cost of additional memory search during each symbol allocation.</p>
</section>
<section id="ownership-conventions">
<h2>Ownership conventions<a class="headerlink" href="#ownership-conventions" title="Permalink to this heading">#</a></h2>
<p>Since data availability is controlled with usage create function and
reference incrementation/decrementation, convention for memory ownership is
required. In case of this project, if not explicitly specified otherwise,
caller of function is owner of all input arguments and remains their owner
after function execution finished (function temporary borrows ownership
of input arguments). If function returns data, ownership of returned data
is passed to function caller. It is responsibility of function caller to
release data returned as result of function execution.</p>
</section>
<section id="source-code">
<h2>Source code<a class="headerlink" href="#source-code" title="Permalink to this heading">#</a></h2>
<section id="mem-h">
<h3>mem.h<a class="headerlink" href="#mem-h" title="Permalink to this heading">#</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef LISP16_MEM_H</span>
<span class="cp">#define LISP16_MEM_H</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;cell.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;status.h&quot;</span><span class="cp"></span>


<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">nil</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">zero</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">one</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">quote</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">quasiquote</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">unquote</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">unquote_splicing</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// internal</span>
<span class="w">    </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">last_addr</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">root</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_cell_t</span><span class="w"> </span><span class="n">cells</span><span class="p">[];</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">lsp_mem_t</span><span class="p">;</span><span class="w"></span>


<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_init</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">size</span><span class="p">);</span><span class="w"></span>
<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_inc_ref</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">lsp_mem_dec_ref</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>

<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_number</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_int32_t</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_pair</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">first</span><span class="p">,</span><span class="w"></span>
<span class="w">                                 </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">second</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_string</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">data_len</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_symbol_from_string</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"></span>
<span class="w">                                               </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_symbol_from_char</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"></span>
<span class="w">                                             </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_builtin_function</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"></span>
<span class="w">                                             </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_builtin_syntax</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"></span>
<span class="w">                                           </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_function</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">parent_ctx</span><span class="p">,</span><span class="w"></span>
<span class="w">                                     </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"></span>
<span class="w">                                     </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_syntax</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">parent_ctx</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">);</span><span class="w"></span>

<span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_eq</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_equal</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">a2</span><span class="p">);</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_is_number</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_is_number</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_is_pair</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_is_pair</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_is_string</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_is_string</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_is_symbol</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_is_symbol</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_is_builtin_function</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                     </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_is_builtin_function</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_is_builtin_syntax</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                   </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_is_builtin_syntax</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_is_function</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_is_function</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_is_syntax</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_is_syntax</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_is_string_or_symbol</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                     </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_is_string_or_symbol</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_is_builtin</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_is_builtin</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_is_function_or_syntax</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                       </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_is_function_or_syntax</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_int32_t</span><span class="w"> </span><span class="nf">lsp_mem_get_number</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_number</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="nf">lsp_mem_get_pair_first</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_pair_first</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="nf">lsp_mem_get_pair_second</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                 </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_pair_second</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="nf">lsp_mem_get_string_len</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                  </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_string_len</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_uint8_t</span><span class="w"> </span><span class="nf">lsp_mem_get_string_data</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                  </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_string_data</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="nf">lsp_mem_get_symbol_len</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                  </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_symbol_len</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_uint8_t</span><span class="w"> </span><span class="nf">lsp_mem_get_symbol_name</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                  </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_symbol_name</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="nf">lsp_mem_get_builtin_index</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                     </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_builtin_index</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="nf">lsp_mem_get_function_parent_ctx</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                         </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_function_parent_ctx</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="nf">lsp_mem_get_function_args</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                   </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_function_args</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="nf">lsp_mem_get_function_body</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                   </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_function_body</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="nf">lsp_mem_get_syntax_parent_ctx</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                       </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_syntax_parent_ctx</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="nf">lsp_mem_get_syntax_args</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                 </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_syntax_args</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="nf">lsp_mem_get_syntax_body</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"></span>
<span class="w">                                                 </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_cell_get_syntax_body</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">lsp_mem_set_pair_first</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"></span>
<span class="w">                                          </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">first</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_cell_set_pair</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">first</span><span class="p">,</span><span class="w"></span>
<span class="w">                      </span><span class="n">lsp_cell_get_pair_second</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">lsp_mem_set_pair_second</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"></span>
<span class="w">                                           </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">second</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_cell_set_pair</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_cell_get_pair_first</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">),</span><span class="w"></span>
<span class="w">                      </span><span class="n">second</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">lsp_mem_set_string_data</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"></span>
<span class="w">                                           </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint8_t</span><span class="w"> </span><span class="n">data_i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_cell_set_string_data</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">data_i</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#endif</span>
</pre></div>
</div>
</section>
<section id="mem-c">
<h3>mem.c<a class="headerlink" href="#mem-c" title="Permalink to this heading">#</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;mem.h&quot;</span><span class="cp"></span>


<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">get_mark</span><span class="p">(</span><span class="n">lsp_cell_t</span><span class="w"> </span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="o">*</span><span class="n">c</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x8000</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">set_mark</span><span class="p">(</span><span class="n">lsp_cell_t</span><span class="w"> </span><span class="o">*</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="n">mark</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mark</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">*</span><span class="n">c</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="mh">0x8000</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">*</span><span class="n">c</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="mh">0x7fff</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">restore</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">lsp_cell_t</span><span class="w"> </span><span class="o">*</span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">get_mark</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">c_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_cell_get_size</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">c_size</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">set_mark</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_cell_is_pair</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_cell_get_pair_first</span><span class="p">(</span><span class="n">c</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_cell_get_pair_second</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_cell_is_function</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_cell_get_function_parent_ctx</span><span class="p">(</span><span class="n">c</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_cell_get_function_args</span><span class="p">(</span><span class="n">c</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_cell_get_function_body</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_cell_is_syntax</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_cell_get_syntax_parent_ctx</span><span class="p">(</span><span class="n">c</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_cell_get_syntax_args</span><span class="p">(</span><span class="n">c</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_cell_get_syntax_body</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">mark_and_restore</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">addr</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">set_mark</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">zero</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">quote</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">quasiquote</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">unquote</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">unquote_splicing</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">restore</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">root</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">is_free_cell</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"></span>
<span class="w">                               </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">used_addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addr</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">get_mark</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="o">*</span><span class="n">used_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">find_free_cell</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">size</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_ERR_MEM</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">last_addr</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_free_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="o">*</span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">last_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">last_addr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_free_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="o">*</span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">last_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_ERR_MEM</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">find_free_cell_with_gc</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"></span>
<span class="w">                                           </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_free_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">mark_and_restore</span><span class="p">(</span><span class="n">m</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">find_free_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">alloc_cell</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"></span>
<span class="w">                               </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">root</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_free_cell_with_gc</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">root</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_cell_set_pair</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">root</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_free_cell_with_gc</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_cell_get_pair_second</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">root</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_mem_set_pair_first</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">is_symbol_from_string</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">symbol</span><span class="p">,</span><span class="w"></span>
<span class="w">                                        </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">str_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_cell_get_string_len</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">str</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_mem_get_symbol_len</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">symbol</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">str_len</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">str_len</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_mem_get_symbol_name</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"></span>
<span class="w">            </span><span class="n">lsp_mem_get_string_data</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">is_symbol_from_char</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">symbol</span><span class="p">,</span><span class="w"></span>
<span class="w">                                      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">name_len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_mem_get_symbol_len</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">symbol</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">name_len</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">name_len</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_mem_get_symbol_name</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">find_symbol_from_string</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"></span>
<span class="w">                                            </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">get_mark</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_cell_is_symbol</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">            </span><span class="n">is_symbol_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="o">*</span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lsp_cell_get_size</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_ERR</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">static</span><span class="w"> </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">find_symbol_from_char</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"></span>
<span class="w">                                          </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">name_len</span><span class="p">,</span><span class="w"></span>
<span class="w">                                          </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">get_mark</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_cell_is_symbol</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">            </span><span class="n">is_symbol_from_char</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">name_len</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="o">*</span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lsp_cell_get_size</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_ERR</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_init</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">last_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">addr</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">set_mark</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_free_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_cell_set_pair</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_free_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_cell_get_number_size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">zero</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_cell_set_number</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_free_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_cell_get_number_size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_cell_set_number</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_free_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_cell_get_string_symbol_size</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">quote</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_cell_set_symbol</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">quote</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">lsp_cell_set_symbol_name</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">quote</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;quote&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>

<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_free_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_cell_get_string_symbol_size</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"></span>
<span class="w">                            </span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">quasiquote</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_cell_set_symbol</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">quasiquote</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">lsp_cell_set_symbol_name</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">quasiquote</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"></span>
<span class="w">                                 </span><span class="p">(</span><span class="s">&quot;quasiquote&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>

<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">find_free_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_cell_get_string_symbol_size</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">unquote</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_cell_set_symbol</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">unquote</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">lsp_cell_set_symbol_name</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">unquote</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;unquote&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>

<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_free_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_cell_get_string_symbol_size</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span><span class="w"></span>
<span class="w">                            </span><span class="o">&amp;</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">unquote_splicing</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_cell_set_symbol</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">unquote_splicing</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">lsp_cell_set_symbol_name</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">unquote_splicing</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"></span>
<span class="w">                                 </span><span class="p">(</span><span class="s">&quot;unquote-splicing&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>

<span class="w">    </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_inc_ref</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">zero</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">one</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">quote</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">root</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_free_cell_with_gc</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">root</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_cell_set_pair</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">root</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="kt">void</span><span class="w"> </span><span class="nf">lsp_mem_dec_ref</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">zero</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">one</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">quote</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">curr_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">root</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">prev_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">curr_addr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_cell_get_pair_first</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">curr_addr</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_cell_get_pair_second</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">curr_addr</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">prev_addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">second</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">lsp_mem_set_pair_second</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">prev_addr</span><span class="p">,</span><span class="w"> </span><span class="n">second</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">prev_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr_addr</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">curr_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">second</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_number</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_int32_t</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_cell_get_number_size</span><span class="p">(</span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloc_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_cell_set_number</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_pair</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">first</span><span class="p">,</span><span class="w"></span>
<span class="w">                                 </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">second</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloc_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_cell_set_pair</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">second</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_string</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">data_len</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_cell_get_string_symbol_size</span><span class="p">(</span><span class="n">data_len</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloc_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_cell_set_string</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">data_len</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_symbol_from_string</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"></span>
<span class="w">                                               </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">find_symbol_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_mem_inc_ref</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">name_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_mem_get_string_len</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_cell_get_string_symbol_size</span><span class="p">(</span><span class="n">name_len</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloc_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_cell_set_symbol</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">name_len</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">name_len</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">lsp_cell_set_symbol_name</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"></span>
<span class="w">                                 </span><span class="n">lsp_mem_get_string_data</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_symbol_from_char</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"></span>
<span class="w">                                             </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">name_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">name_len</span><span class="p">])</span><span class="w"></span>
<span class="w">        </span><span class="n">name_len</span><span class="o">++</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">find_symbol_from_char</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">name_len</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_mem_inc_ref</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_cell_get_string_symbol_size</span><span class="p">(</span><span class="n">name_len</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloc_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_cell_set_symbol</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">name_len</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">name_len</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">lsp_cell_set_symbol_name</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_builtin_function</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"></span>
<span class="w">                                             </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloc_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_cell_set_builtin_function</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_builtin_syntax</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"></span>
<span class="w">                                           </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloc_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_cell_set_builtin_syntax</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_function</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">parent_ctx</span><span class="p">,</span><span class="w"></span>
<span class="w">                                     </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"></span>
<span class="w">                                     </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloc_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_cell_set_function</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">parent_ctx</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_status_t</span><span class="w"> </span><span class="nf">lsp_mem_create_syntax</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">parent_ctx</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">lsp_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloc_cell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">lsp_cell_set_syntax</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">cells</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">parent_ctx</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LSP_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_eq</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">a2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">a2</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_mem_is_number</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">lsp_mem_is_number</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lsp_mem_get_number</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">lsp_mem_get_number</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="n">lsp_bool_t</span><span class="w"> </span><span class="nf">lsp_mem_equal</span><span class="p">(</span><span class="n">lsp_mem_t</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_addr_t</span><span class="w"> </span><span class="n">a2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_mem_eq</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_mem_is_pair</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">lsp_mem_is_pair</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">a1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">nil</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">lsp_mem_equal</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lsp_mem_get_pair_first</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">),</span><span class="w"></span>
<span class="w">                               </span><span class="n">lsp_mem_get_pair_first</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">)))</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="n">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_mem_get_pair_second</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_mem_get_pair_second</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">a2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_mem_is_string</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">lsp_mem_is_string</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">a1_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_mem_get_string_len</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">a2_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsp_mem_get_string_len</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a1_len</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">a2_len</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_uint16_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">a1_len</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lsp_mem_get_string_data</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"></span>
<span class="w">                </span><span class="n">lsp_mem_get_string_data</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="stream.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Input/output stream</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="cell.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Data types</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Bozo Kopic
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Memory management</a><ul>
<li><a class="reference internal" href="#memory-layout">Memory layout</a></li>
<li><a class="reference internal" href="#data-allocation">Data allocation</a></li>
<li><a class="reference internal" href="#garbage-collector">Garbage collector</a></li>
<li><a class="reference internal" href="#data-usage">Data usage</a></li>
<li><a class="reference internal" href="#symbol-reusability">Symbol reusability</a></li>
<li><a class="reference internal" href="#ownership-conventions">Ownership conventions</a></li>
<li><a class="reference internal" href="#source-code">Source code</a><ul>
<li><a class="reference internal" href="#mem-h">mem.h</a></li>
<li><a class="reference internal" href="#mem-c">mem.c</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>